<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AlmostOS — GUI型OS(もどき) (Polished)</title>
  <link rel="stylesheet" href="assets/base.css">
  <link rel="stylesheet" href="assets/os.css">
</head>
<body>
  <div id="splash" aria-label="Splash screen">
    <div class="splash-card">
      <div class="splash-logo">⟡</div>
      <div class="splash-title">AlmostOS</div>
      <div class="splash-sub">starting up…</div>
      <div class="splash-bar"><div></div></div>
    </div>
  </div>

  <div id="lockScreen" aria-label="Lock screen">
    <div class="lock-bg"></div>
    <div class="lock-wrap">
      <div>
        <div class="lock-clock" id="lockClock">00:00</div>
        <div class="lock-date" id="lockDate">—</div>
      </div>

      <div class="lock-card" id="lockCard">
        <div class="lock-avatar">🧑‍🚀</div>
        <div class="lock-user" id="lockUser">Guest</div>
        <div class="lock-hint" id="lockHint">クリック / Enter でログイン</div>

        <div class="pin-row" id="pinRow" style="display:none">
          <input id="pinInput" placeholder="PIN" inputmode="numeric" autocomplete="current-password" />
          <button class="btn" id="unlockBtn">Unlock</button>
        </div>

        <div class="lock-err" id="pinErr"></div>

        <div class="lock-actions">
          <button class="btn ghost" id="setPinBtn" title="PINを設定（この端末のlocalStorageに保存）">PIN設定</button>
          <button class="btn" id="enterBtn">Enter</button>
        </div>
      </div>
    </div>
  </div>

  <div id="desktop" tabindex="0" aria-label="desktop">
    <div class="icon-grid" id="iconGrid"></div>

    <div id="wallpaperHint">
      <span>AlmostOS</span>
      <span style="opacity:.55">/</span>
      <span>ショートカット:</span>
      <kbd>Ctrl</kbd>+<kbd>Space</kbd><span style="opacity:.55">Start</span>
      <kbd>Ctrl</kbd>+<kbd>&#96;</kbd><span style="opacity:.55">Terminal</span>
      <kbd>Esc</kbd><span style="opacity:.55">閉じる</span>
    </div>

    <div class="toast" id="toast"></div>

    <div id="startMenu" role="dialog" aria-label="Start Menu">
      <div class="menu-top">
        <input id="search" placeholder="検索（アプリ名 / コマンド）" />
      </div>
      <div class="menu-grid" id="menuGrid"></div>
      <div class="menu-footer">
        <div class="pill" id="installBtn">➕ Install</div>
        <div class="pill" id="aboutBtn">ℹ️ About</div>
        <div class="pill danger" id="bsodBtn" title="疑似クラッシュ（BSOD）">💥 BSOD</div>
        <div class="pill" id="downloadBtn" title="クリック=クリーン / Shift+クリック=状態入り（#importで取り込み）">⬇️ HTML</div>
        <div class="pill" id="lockBtn">🔒 Lock <kbd>Ctrl</kbd>+<kbd>L</kbd></div>
        <div class="pill" id="saveBtn">💾 保存 <kbd>Ctrl</kbd>+<kbd>S</kbd></div>
      </div>
    </div>

    <div id="quickPanel" role="dialog" aria-label="Quick Panel">
      <div class="toggle">
        <div>
          <b>ネオン強め</b>
          <div class="tiny">背景の発光をちょい盛り</div>
        </div>
        <div class="switch" id="swGlow" role="switch" aria-checked="false"></div>
      </div>
      <div class="toggle">
        <div>
          <b>アニメ控えめ</b>
          <div class="tiny">動きが酔う人向け</div>
        </div>
        <div class="switch" id="swReduceMotion" role="switch" aria-checked="false"></div>
      </div>
      <div class="toggle">
        <div>
          <b>壁紙ヒント</b>
          <div class="tiny">左下のショートカット表示</div>
        </div>
        <div class="switch on" id="swHint" role="switch" aria-checked="true"></div>
      </div>
      <div class="toggle">
        <div>
          <b>グリッドにスナップ</b>
          <div class="tiny">アイコン移動を格子に吸着</div>
        </div>
        <div class="switch" id="swSnap" role="switch" aria-checked="false"></div>
      </div>
      <div class="tiny">Tips: ウィンドウはドラッグ移動 / 右下でリサイズ / ダブルクリックで最大化。</div>
    </div>

    <div id="snapOverlay" aria-hidden="true"></div>

    <div id="contextMenu" role="menu" aria-label="Desktop menu">
      <div class="ctx-item" data-act="start"><span>⟡ Start</span><span class="hint">Ctrl+Space</span></div>
      <div class="ctx-item" data-act="notes"><span>📝 Notes</span><span class="hint">—</span></div>
      <div class="ctx-item" data-act="appcenter"><span>🧩 App Center</span><span class="hint">—</span></div>
      <div class="ctx-item" data-act="lock"><span>🔒 Lock</span><span class="hint">Ctrl+L</span></div>
      <div class="ctx-sep"></div>
      <div class="ctx-item" data-act="save"><span>💾 保存</span><span class="hint">Ctrl+S</span></div>
      <div class="ctx-item" data-act="export"><span>⬇️ HTML 書き出し</span><span class="hint">Shift=状態入り</span></div>
      <div class="ctx-sep"></div>
      <div class="ctx-item" data-act="toggleGlow"><span>✨ ネオン強め</span><span class="hint">toggle</span></div>
      <div class="ctx-item" data-act="toggleReduce"><span>🫧 アニメ控えめ</span><span class="hint">toggle</span></div>
      <div class="ctx-item" data-act="toggleHint"><span>💡 壁紙ヒント</span><span class="hint">toggle</span></div>
      <div class="ctx-sep"></div>
      <div class="ctx-item" data-act="toggleSnap"><span>🧲 グリッドにスナップ</span><span class="hint" id="snapHint">off</span></div>
      <div class="ctx-item" data-act="alignGrid"><span>📐 整列（グリッド）</span><span class="hint">—</span></div>
      <div class="ctx-item" data-act="resetIcons"><span>↩︎ 配置リセット</span><span class="hint">—</span></div>
    </div>

    <div id="taskbar" aria-label="Taskbar">
      <div id="startBtn" title="Start (Ctrl+Space)">⟡</div>
      <div id="taskApps" aria-label="Running apps"></div>
      <div id="tray">
        <div id="clock">--:--:--</div>
        <div id="quickBtn" title="Quick Panel">⚙︎</div>
      </div>
    </div>
  </div>

  <input id="filePicker" type="file" style="display:none" />

  <template id="winTpl">
    <div class="win" role="window">
      <div class="titlebar">
        <div class="title-left">
          <div class="title-ico">□</div>
          <div class="title-text">
            <div class="name">Window</div>
            <div class="sub">AlmostOS</div>
          </div>
        </div>
        <div class="title-actions">
          <button class="wbtn" data-act="min" title="最小化">—</button>
          <button class="wbtn" data-act="max" title="最大化/戻す">▢</button>
          <button class="wbtn danger" data-act="close" title="閉じる">✕</button>
        </div>
      </div>
      <div class="content"></div>
      <div class="resize-handle" title="Resize"></div>
    </div>
  </template>

<script src="assets/os.js" defer></script>
</body>
</html>
